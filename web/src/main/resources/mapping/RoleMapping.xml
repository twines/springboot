<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.twins.lee.mapper.RoleMapper">

    <resultMap id="roleResultMap" type="com.twins.lee.entity.Role">
        <result column="id" jdbcType="INTEGER" property="id"/>
        <result column="role" jdbcType="VARCHAR" property="role"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
        <result column="available" jdbcType="INTEGER" property="available"/>
        <collection property="permissions" ofType="com.twins.lee.entity.Permission">
            <id column="id" property="id"/>
            <result column="name" jdbcType="VARCHAR" property="name"/>
            <result column="resource_type" jdbcType="VARCHAR" property="resourceType"/>
            <result column="url" jdbcType="VARCHAR" property="url"/>
            <result column="permission" jdbcType="VARCHAR" property="permission"/>
            <result column="parent_id" jdbcType="INTEGER" property="parentId"/>
            <result column="parent_ids" jdbcType="VARCHAR" property="parentIds"/>
            <result column="available" jdbcType="INTEGER" property="available"/>
        </collection>
    </resultMap>
    <select id="getRoleById" resultMap="roleResultMap">
     SELECT r_p.id, r_p.role, r_p.available, r_p.description
     , p.id p_id, p.name,p.resource_type,p.url,p.permission,p.parent_id,p.parent_ids,p.available p_available
        FROM (
        SELECT r.* , rp.permission_id FROM role r, role_permission rp
             WHERE
            r.id = rp.role_id and  r.id=#{id}
        ) r_p
        LEFT JOIN
        permission p
         ON r_p.permission_id = p.id
 </select>
</mapper>