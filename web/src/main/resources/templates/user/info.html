<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>完善资料</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../../layuiadmin/style/admin.css" media="all">
    <link rel="stylesheet" href="../../layuiadmin/style/login.css" media="all">
</head>
<body>
<div class="layui-container">
    <div class="layui-tab layui-tab-card">
        <ul class="layui-tab-title">
            <li class="layui-this">基本信息</li>
            <li class="">营业执照</li>
            <li>法人信息</li>
        </ul>

        <div class="layui-tab-content" style="height: 100%;">
            <div class="layui-tab-item layui-show">
                <div class="layui-row">
                    <span>企业名称：</span> <span th:text="${userInfo.qymc_cn}">企业名称</span>
                </div>
                <div class="layui-row">
                    <span>企业机构代码：</span> <span th:text="${userInfo.zzjgdm}">机构代码</span>
                </div>
                <div class="layui-row">
                    <span>企业法人：</span> <span th:text="${userInfo.improv.name}">法人</span>
                </div>
                <div class="layui-row">
                    <span>登录人员：</span> <span> [[${userInfo.name}]]</span>
                </div>

            </div>
            <div class="layui-tab-item">
                <div class="layui-main">
                    <img class="layu-center" th:alt="营业执照" th:src="'/upload'+${userInfo.improv.codeUrl}"
                         style="width: 768px;height: 500%;">
                </div>
            </div>
            <div class="layui-tab-item">
                <div class="layui-main">
                    <img th:alt="法人" th:src="'/upload'+${userInfo.improv.nameUrl}">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/layuiadmin/layui/layui.js"></script>
<script>

    layui.config({
        base: '/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'user', 'upload', 'jquery', 'form'], function () {
        var $ = layui.$
            , setter = layui.setter
            , admin = layui.admin
            , form = layui.form
            , upload = layui.upload
            , router = layui.router()
            , search = router.search;


        form.render();
        form.verify({});
        //提交
        form.on('submit(impovData)', function (obj) {

            //输入的代码
            var codeInput = $("#code-input").val();
            //ocr识别的代码
            var codeOcr = $('#code-tmp').val();


            //执照识别出的法人
            var codeName = $('#code-name-tmp').val();

            //输入的名字
            var nameInput = $("#name-input").val();

//识别的名字
            var nameOcr = $('#name-tmp').val();

            // console.log(codeOcr);
            // console.log(codeInput);
            // console.log(nameInput);
            // console.log(codeName);

            if (codeOcr !== codeInput) {

                layer.msg("请检查统一社会信用代码");

                return;
            }


            // if (nameInput !== nameOcr) {
            //     layer.msg("请核对法人姓名");
            //     layer.closeAll('loading'); //关闭loading
            //
            //     return;
            // }
            // if (nameOcr !== codeName) {
            //     layer.msg("法人身份与营业执照不符合");
            //     layer.closeAll('loading'); //关闭loading
            //
            //     return;
            // }

            if (codeName !== nameInput || nameInput !== nameOcr) {
                var msg = "法人姓名与身份证识别输入不一致";
                layer.msg(msg);
                return;
            }
            layer.load(); //上传loading

            admin.req({
                url: '/user/doImpov',
                method: 'POST',
                data: obj.field,

                done: function (res) {
                    layer.closeAll('loading'); //关闭loading


                }
            });
            return false;
        });


    });
</script>
</body>
</html>